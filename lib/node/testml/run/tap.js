// Generated by CoffeeScript 2.3.0
(function() {
  require('../../testml/run');

  require('../../testml/tap');

  module.exports = TestML.Run.TAP = class TAP extends TestML.Run {
    static run(file) {
      (new this).from_file(file).test();
    }

    constructor(params = {}) {
      super(params);
      ({output: this.output} = params);
      this.tap = new TestML.TAP;
      return;
    }

    testml_begin() {}

    testml_end() {
      this.tap.done_testing();
      if (TestML.browser && this.output) {
        this.output.value = this.tap.output;
      }
    }

    testml_eq(got, want, label) {
      if (_.isString(want) && got !== want && want.match(/\n/) && (this.getv('Diff') || this.getp('DIFF'))) {
        if (!TestML.browser) {
          global.JsDiff = require('diff');
        }
        this.tap.fail(label);
        this.tap.diag(JsDiff.createTwoFilesPatch('want', 'got', want, got, '', '', {
          context: 3
        }));
      } else {
        this.tap.is_eq(got, want, label);
      }
    }

    testml_like(got, want, label) {
      return this.tap.like(got, want, label);
    }

    testml_str_has(got, want, label) {
      if (got.indexOf(want) !== -1) {
        return this.tap.pass(label);
      } else {
        return this.tap.fail(label);
      }
    }

    testml_list_has(got, want, label) {
      if ((_.findIndex(got, function(str) {
        return str === want;
      })) !== -1) {
        return this.tap.pass(label);
      } else {
        return this.tap.fail(label);
      }
    }

  };

  // vim: ft=coffee sw=2:

}).call(this);
