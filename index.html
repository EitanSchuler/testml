<script src="https://unpkg.com/testml-compiler/lib/testml-compiler/browser.js"></script>
<script src="npm/lib/testml-compiler/browser.js"></script>
<script src="https://unpkg.com/lodash/lodash.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>


<h2>TestML Compiler Interactive Demo</h2>
<div id="nav">
<!-- input id="update" type="button" value="Recompile" onclick="compileTestML()" /-->
<select id="yaml" onchange="setYAMLTest(this.value)"><option>YAML Test Suite</option></select>
</div>

<textarea id="input"></textarea>
<textarea id="output"></textarea>
<br>
<div id="explanation">
This is an interactive demo for the TestML Compiler. You can change the TestML
on the left side and it will auto-recompile into the right side. If the
compilation fails it will show the error message.<br><br>

You can also trying compiling all of the TestML files that are in the <a
href="https://github.com/yaml/yaml-test-suite/tree/testml-new/test">YAML Test
Suite</a> by choosing a test from the drop down menu.<br><br>

<a href="https://github.com/testml-lang/testml-compiler">Fork me on GitHub</a><br><br>

Check out <a href="https://testml-lang.github.io/testml/">TestML Running in Browser</a>!<br><br>
</div>


<script>
sample_testml = `\
# A simple testml file

# For test frameworks that support planning:
Plan = 3


# Assertion loops:
*input.get-sha1 == *sha1
*input.get-md5 == *md5


# Test data blocks:
=== Test 1
--- input: I like pie.
--- sha1: 5f30adb9864439315a33e1a6631358164f94cc20

=== Test 2
--- input
I like pie.
--- sha1: 53b3de1f1d480989d391f24a8886d291773347a7
--- md5: 29a529ed285c7f5cd6c3bff4b3bb7626
`
$('#input').focus()
$("#input")[0].setSelectionRange(0,0)

function compileTestML() {
  var input = $('#input')[0].value
  var output

  try {
    output = (new TestMLCompiler.Compiler).compile(input)
  }
  catch(e) {
    output = String(e)
  }

  $('#output')[0].value = output

  $('#input').focus()
}

function setYAMLTest(id) {
  $.ajax({
    url: "https://api.github.com/repos/yaml/yaml-test-suite/contents/test/" + id + ".tml?ref=testml-new",
    headers: {"Accept": "application/vnd.github.v3.raw"},
  }).done(function(text) {
    $('#input')[0].value = text
    setTimeout(function() {
      $('#input').scrollTop(0)
        .focus()
        [0].setSelectionRange(0,0)
    }, 10)
    compileTestML()
  })
}

yaml_tests = _.split('229Q,236B,26DV,27NA,2AUY,2CMS,2EBW,2JQS,2LFX,2SXE,2XXW,35KP,36F6,3ALJ,3GZX,3HFZ,3MYT,3R3P,3UYS,4ABK,4CQQ,4GC6,4H7K,4HVU,4JVG,4MUZ,4Q9F,4QFQ,4UYU,4V8U,4ZYM,52DL,54T7,55WF,565N,57H4,5BVJ,5C5M,5GBF,5KJE,5LLU,5NYZ,5TRB,5TYM,5U3A,5WE3,65WH,6BCT,6BFJ,6CK3,6FWR,6H3V,6HB6,6JQW,6JTT,6JWB,6LVF,6M2F,6S55,6SLA,6VJK,6WLZ,6WPF,6ZKB,735Y,74H7,753E,77H8,7A4E,7BMT,7BUB,7FWL,7LBH,7MNF,7T8X,7TMG,7W2P,7Z25,7ZZ5,82AN,87E4,8CWC,8G76,8MK2,8QBE,8UDB,8XDJ,8XYN,93JH,93WF,96L6,98YD,9C9N,9CWY,9DXL,9FMG,9J7A,9KAX,9KBC,9MAG,9MMW,9SHH,9TFX,9U5K,9WXW,9YRD,A2M4,A6F9,A984,AB8U,AVM7,AZ63,AZW3,B3HG,B63P,BD7L,BEC7,BF9H,BS4K,BU8L,C2DT,C2SP,C4HZ,CC74,CML9,CN3R,CQ3W,CT4Q,CTN5,CUP7,CXX2,D49Q,D83L,D88J,D9TU,DBG4,DC7X,DFF7,DHP8,DK3J,DMG6,DWX9,E76Z,EB22,EHF6,EW3V,EX5H,EXG3,F2C7,F3CP,F8F9,FBC9,FH7J,FP8R,FQ7F,FRK4,FTA2,FUP4,G4RS,G7JE,G992,G9HC,GDY7,GH63,GT5M,H2RW,H3Z8,H7J7,HMK4,HMQ5,HRE5,HS5T,HU3P,J3BT,J5UC,J7PZ,J7VC,J9HZ,JDH8,JHB9,JQ4R,JS2J,JTV5,JY7Z,K4SU,K527,K54U,K858,KK5P,KMK3,KSS4,KZN9,L94M,L9U5,LE5A,LHL4,LP6E,LQZ7,LX3P,M29M,M5C3,M5DY,M7A3,M7NX,M9B4,MJS9,MXS3,MYW6,MZX3,N4JP,N782,NHX8,NP9H,P2AD,P76L,P94K,PBJ2,PRH3,PUW8,PW8X,Q4CL,Q5MG,Q88A,Q8AD,Q9WF,QB6E,QF4Y,QLJ7,R4YG,RLU9,RR7F,RTP8,RXY3,RZP5,RZT7,S3PD,S4JQ,S4T7,S98Z,S9E8,SBG9,SKE5,SR86,SSW6,SU5Z,SU74,SY6V,SYW4,T26H,T4YY,T5N4,TD5N,TE2A,TL85,TS54,U3C3,U3XV,U44R,U9NS,UDM2,UDR7,UGM3,UT92,V55R,V9D5,W42U,W4TN,W5VH,W9L4,WZ62,X38W,X4QW,XLQ9,XV9V,XW4D,YD5X,Z67P,Z9M4,ZCZ6,ZF4X,ZH7C,ZL4Z,ZVH3,ZWK4', ',')

var select = $('#yaml')
for (var i in yaml_tests) {
  id = yaml_tests[i]
  $('<option />', {value: id, text: id}).appendTo(select)
}

$('#input')[0].value = sample_testml
compileTestML()
$('#input').on('keyup', _.debounce(compileTestML, 333))
</script>


<style>
body {
  font-family: sans-serif;
}
#nav {
  width: 100%;
  padding-bottom: 5px;
}
textarea {
  font-family: monospace;
  width: 500px;
  height: 500px;
}
#explanation {
  padding-top: 15px;
  width: 500px;
}
#update {
  background-color: yellow;
}
</style>
