#!/usr/bin/env coffee

(global.TestML ||= {}).module_paths = module.paths

TestML.root = process.env.TESTML_COMPILER_ROOT \
  or throw "TESTML_COMPILER_ROOT not set. TestML not properly installed."

TestML.module_paths.unshift "#{TestML.root}/lib"
module.paths = TestML.module_paths

require 'testml/prelude'
require 'testml/compiler'

#------------------------------------------------------------------------------
[input_file] = process.argv[2..]
throw "usage: testml-compiler <input-file>" \
  unless input_file?
throw "Input file does not exist: '#{input_file}'" \
  unless file_exists input_file

compiler = new TestML.Compiler

out compiler.compile input_file

# vim: sw=2 lisp:
