#!/bin/bash

# shellcheck disable=SC1090,2034

set -e

[[ -n $TESTML_SOURCED ]] ||
  source "${TESTML_ROOT:-$(dirname "$0")/..}/bin/testml"

export TESTML_LANG=${TESTML_LANG:-perl6}

testml-run-file() {
  local testml_run_file=$1

  export TESTML_RUN=${TESTML_RUN:-TestML::Run::TAP}
  export TESTML_LIB=${TESTML_LIB:-$TESTML_ROOT/lib/perl6}
  export TESTML_BRIDGE=${TESTML_BRIDGE:-TestMLBridge}
  export TESTML_PATH=${TESTML_PATH:-$TESTML_INPUT_DIR}

  "$TESTML_LANG" \
    -I"$TESTML_LIB" \
    -I"$TESTML_PATH" \
    -M"$TESTML_RUN" \
    -e "$TESTML_RUN.run('$testml_run_file')"
}

TESTML_LANG_SOURCED=1

[[ $0 != "${BASH_SOURCE[0]}" ]] || testml-run "$@"
